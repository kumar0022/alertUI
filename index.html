<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sasta Danelli</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header
      class="text-center py-6 bg-gray-800 text-white flex items-center justify-between"
    >
      <h1 class="ml-3px text-3xl">Sasta Danelli</h1>
      <p class="mr-3px text-xl">Bar and Rod Rolling Mill</p>
    </header>

    <!-- Region Cards -->
    <div class="flex flex-wrap gap-6 justify-center mt-8" id="regionContainer">
      <!-- Stand 1-6 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('Stand 1-6')"
        data-alert-count="3"
      >
        <div class="font-semibold text-xl text-gray-800">Stand 1-6</div>
        <div class="alert-count text-sm mt-2" id="alertCountStand1_6">
          <span
            class="alert-badge bg-green-500 text-white px-2 py-1 rounded-full"
            >3 Alerts</span
          >
        </div>
      </div>
      <!-- Shear 1 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('Shear 1')"
        data-alert-count="5"
      >
        <div class="font-semibold text-xl text-gray-800">Shear 1</div>
        <div class="alert-count text-sm mt-2" id="alertCountShear1">
          <span
            class="alert-badge bg-yellow-500 text-white px-2 py-1 rounded-full"
            >5 Alerts</span
          >
        </div>
      </div>
      <!-- Stand 7-12 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('Stand 7-12')"
        data-alert-count="8"
      >
        <div class="font-semibold text-xl text-gray-800">Stand 7-12</div>
        <div class="alert-count text-sm mt-2" id="alertCountStand7_12">
          <span class="alert-badge bg-red-500 text-white px-2 py-1 rounded-full"
            >8 Alerts</span
          >
        </div>
      </div>
      <!-- Shear 2 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('Shear 2')"
        data-alert-count="2"
      >
        <div class="font-semibold text-xl text-gray-800">Shear 2</div>
        <div class="alert-count text-sm mt-2" id="alertCountShear2">
          <span
            class="alert-badge bg-green-500 text-white px-2 py-1 rounded-full"
            >2 Alerts</span
          >
        </div>
      </div>
      <!-- Stand 13-18 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('Stand 13-18')"
        data-alert-count="12"
      >
        <div class="font-semibold text-xl text-gray-800">Stand 13-18</div>
        <div class="alert-count text-sm mt-2" id="alertCountStand13_18">
          <span class="alert-badge bg-red-500 text-white px-2 py-1 rounded-full"
            >12 Alerts</span
          >
        </div>
      </div>
      <!-- CVR Line 1 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('CVR Line 1')"
        data-alert-count="4"
      >
        <div class="font-semibold text-xl text-gray-800">CVR Line 1</div>
        <div class="alert-count text-sm mt-2" id="alertCountCVRLine1">
          <span
            class="alert-badge bg-yellow-500 text-white px-2 py-1 rounded-full"
            >4 Alerts</span
          >
        </div>
      </div>
      <!-- CVR Line 2 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('CVR Line 2')"
        data-alert-count="6"
      >
        <div class="font-semibold text-xl text-gray-800">CVR Line 2</div>
        <div class="alert-count text-sm mt-2" id="alertCountCVRLine2">
          <span
            class="alert-badge bg-yellow-500 text-white px-2 py-1 rounded-full"
            >6 Alerts</span
          >
        </div>
      </div>
      <!-- FFB Line 1 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('FFB Line 1')"
        data-alert-count="1"
      >
        <div class="font-semibold text-xl text-gray-800">FFB Line 1</div>
        <div class="alert-count text-sm mt-2" id="alertCountFFBLine1">
          <span
            class="alert-badge bg-green-500 text-white px-2 py-1 rounded-full"
            >1 Alert</span
          >
        </div>
      </div>
      <!-- FFB Line 2 -->
      <div
        class="region-card flex-1 min-w-[250px] max-w-xs p-4 border rounded-lg bg-white shadow-md cursor-pointer hover:bg-gray-50"
        onclick="openModal('FFB Line 2')"
        data-alert-count="7"
      >
        <div class="font-semibold text-xl text-gray-800">FFB Line 2</div>
        <div class="alert-count text-sm mt-2" id="alertCountFFBLine2">
          <span class="alert-badge bg-red-500 text-white px-2 py-1 rounded-full"
            >7 Alerts</span
          >
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
      id="alertModal"
    >
      <div
        class="bg-white w-[90%] max-w-4xl max-h-[80%] p-6 rounded-lg overflow-auto relative"
      >
        <span
          class="absolute top-4 right-4 text-xl cursor-pointer"
          onclick="closeModal()"
          >Ã—</span
        >
        <div class="text-2xl font-semibold mb-6" id="modalHeader">
          Region Alerts
        </div>
        <div id="charts"></div>
      </div>
    </div>

    <script>
      // Alert data with metrics and the number of alerts
      const regionMetrics = {
        "Stand 1-6": {
          RPM: [500, 520, 510, 530, 550],
          Torque: [120, 125, 130, 128, 132],
          Elongation: [1.2, 1.3, 1.25, 1.35, 1.4],
          LineSpeed: [30, 32, 31, 33, 34],
          Times: ["08:00", "08:30", "09:00", "09:30", "10:00"],
          alertCount: 3, // The number of alerts for this region
        },
        "Shear 1": {
          RPM: [480, 490, 500, 495, 505],
          Torque: [110, 112, 115, 114, 117],
          Elongation: [1.1, 1.15, 1.12, 1.18, 1.2],
          LineSpeed: [28, 29, 30, 29.5, 30.5],
          Times: ["08:15", "08:45", "09:15", "09:45", "10:15"],
          alertCount: 5,
        },
        "Stand 7-12": {
          RPM: [450, 460, 470, 480, 490],
          Torque: [115, 118, 120, 125, 130],
          Elongation: [1.15, 1.2, 1.25, 1.3, 1.35],
          LineSpeed: [30, 31, 32, 32.5, 33],
          Times: ["08:10", "08:40", "09:10", "09:40", "10:10"],
          alertCount: 8,
        },
        "Shear 2": {
          RPM: [460, 470, 480, 485, 490],
          Torque: [100, 105, 110, 108, 112],
          Elongation: [1.05, 1.1, 1.15, 1.18, 1.2],
          LineSpeed: [27, 28, 29, 30, 30.5],
          Times: ["08:20", "08:50", "09:20", "09:50", "10:20"],
          alertCount: 2,
        },
        "Stand 13-18": {
          RPM: [510, 520, 530, 540, 550],
          Torque: [125, 130, 135, 140, 145],
          Elongation: [1.3, 1.35, 1.4, 1.45, 1.5],
          LineSpeed: [32, 33, 34, 35, 36],
          Times: ["08:30", "09:00", "09:30", "10:00", "10:30"],
          alertCount: 12,
        },
        "CVR Line 1": {
          RPM: [470, 480, 490, 495, 500],
          Torque: [115, 120, 125, 130, 135],
          Elongation: [1.1, 1.12, 1.15, 1.18, 1.2],
          LineSpeed: [28, 29, 30, 31, 32],
          Times: ["08:05", "08:35", "09:05", "09:35", "10:05"],
          alertCount: 4,
        },
        "CVR Line 2": {
          RPM: [490, 500, 510, 520, 530],
          Torque: [120, 125, 130, 135, 140],
          Elongation: [1.2, 1.25, 1.3, 1.35, 1.4],
          LineSpeed: [30, 31, 32, 33, 34],
          Times: ["08:40", "09:10", "09:40", "10:10", "10:40"],
          alertCount: 6,
        },
        "FFB Line 1": {
          RPM: [500, 510, 520, 530, 540],
          Torque: [125, 130, 135, 140, 145],
          Elongation: [1.3, 1.35, 1.4, 1.45, 1.5],
          LineSpeed: [31, 32, 33, 34, 35],
          Times: ["08:50", "09:20", "09:50", "10:20", "10:50"],
          alertCount: 1,
        },
        "FFB Line 2": {
          RPM: [510, 520, 530, 540, 550],
          Torque: [130, 135, 140, 145, 150],
          Elongation: [1.4, 1.45, 1.5, 1.55, 1.6],
          LineSpeed: [32, 33, 34, 35, 36],
          Times: ["08:30", "09:00", "09:30", "10:00", "10:30"],
          alertCount: 7,
        },
      };

      // Function to set region card color based on the number of alerts
      function setRegionCardColor() {
        // Get all region cards
        const regionCards = document.querySelectorAll(".region-card");
        regionCards.forEach((card) => {
          const alertCount = parseInt(card.getAttribute("data-alert-count"));
          const alertBadge = card.querySelector(".alert-badge");

          // Set the badge color based on the alert count
          if (alertCount <= 3) {
            alertBadge.classList.add("bg-green-500");
            alertBadge.classList.remove("bg-yellow-500", "bg-red-500");
          } else if (alertCount <= 6) {
            alertBadge.classList.add("bg-yellow-500");
            alertBadge.classList.remove("bg-green-500", "bg-red-500");
          } else {
            alertBadge.classList.add("bg-red-500");
            alertBadge.classList.remove("bg-green-500", "bg-yellow-500");
          }
        });
      }

      // Run the function to color the badges
      setRegionCardColor();

      // Function to open modal (just for demonstration)
      function openModal(region) {
        alert("Opening modal for " + region);
      }
      // Update region card colors based on alert count
      Object.entries(regionMetrics).forEach(([region, data]) => {
        setRegionCardColor(region, data.alertCount);
      });

      // Function to open the modal and show the region's metrics and charts
      function openModal(region) {
        const modal = document.getElementById("alertModal");
        const modalHeader = document.getElementById("modalHeader");
        const chartsContainer = document.getElementById("charts");

        modalHeader.textContent = `${region} Metrics`;
        chartsContainer.innerHTML = "";

        const metrics = regionMetrics[region];
        if (!metrics) return;

        for (const [metric, values] of Object.entries(metrics)) {
          if (metric !== "alertCount") {
            const chartCanvas = document.createElement("canvas");
            chartsContainer.appendChild(chartCanvas);

            const chartData = {
              labels: metrics.Times,
              datasets: [
                {
                  label: metric,
                  data: values,
                  borderColor: "rgba(75, 192, 192, 1)",
                  backgroundColor: "rgba(75, 192, 192, 0.2)",
                  fill: true,
                },
              ],
            };

            new Chart(chartCanvas, {
              type: "line",
              data: chartData,
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    display: true,
                    position: "top",
                  },
                },
                scales: {
                  x: {
                    title: {
                      display: true,
                      text: "Time",
                    },
                  },
                  y: {
                    title: {
                      display: true,
                      text: metric,
                    },
                  },
                },
              },
            });
          }
        }

        modal.classList.remove("hidden");
      }

      // Function to close the modal
      function closeModal() {
        const modal = document.getElementById("alertModal");
        modal.classList.add("hidden");
      }
    </script>
  </body>
</html>
